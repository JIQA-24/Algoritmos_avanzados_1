#include <iostream>
#include <fstream>
#include <vector>

using namespace std;

int Contador = 0;
int tota = 0;

//******************** Parte 1 ********************

vector<int> PreProcesamiento(string Mcode){
    int l = Mcode.length();

    vector<int> kmp(1,0);
    int pPatron = 0;

    for (int iter = 1; iter < l; iter++){
        if(Mcode[iter] == Mcode[pPatron]){
            pPatron++;
            kmp.push_back(pPatron);
        }else{
            pPatron = 0;
            kmp.push_back(pPatron);
        }
    }

    return kmp;
}

//o(n)
//encontrar el Virus en el string
void KMP(string Transmision, string Mcode, vector<int> kmp, int cont){

    int tamanoPatron = Mcode.length();
    int posPatron = 0;

    for (int i = 0; i < Transmision.length(); i++){
    	
    	cont++;

        if (Mcode[posPatron] == Transmision[i]){
            posPatron++;
            
            if (posPatron == tamanoPatron){
                int nuevaPosicion = i - (tamanoPatron - 1);
                nuevaPosicion = nuevaPosicion + 1; //Por que es Base 1;
                cout << tota+nuevaPosicion << " ";
                posPatron = kmp[posPatron - 1];
                Contador = Contador + 1;
            }
        }else{
            if (posPatron != 0){
                posPatron = kmp[posPatron - 1];
                i--;
            }
        }
    }
    tota=tota+cont;
}

//******************** Parte 2 ********************

string aumenta(string S){
  string s = "";
  for (char c:S){
    s = s+"|"+c;
  }
  return s+"|";
}

pair<int,int> manacher(string S){
  pair<int,int> res(0,0); // resultado (inicio, longitud)
  if (S.length() == 0) // S es nulo
    return res;
  string T = aumenta(S);  // llamar a funci�n
  int N = T.length();
  // longitud y centro del m�ximo pal�ndromo encontrado
  int maxLong=1, maxCentro=1; // Hasta ahora posici�n 1
  int L[N];
  int C = 1;
  int Li = 0, Ri = 0;
  bool expansion = false; // true si requiera expansi�n

  L[0]=0; L[1]=1;
  for (Ri=2; Ri<N; Ri++){
    expansion = false;
    Li = C - (Ri-C);
    if ((C+L[C])-Ri >= 0){
      if(L[Li] < (C+L[C])-Ri) // Caso 1
				L[Ri] = L[Li];
			else if(L[Li] == (C+L[C])-Ri && (C+L[C]) == N-1) // Caso 2
				L[Ri] = L[Li];
			else if(L[Li] == (C+L[C])-Ri && (C+L[C]) < N-1){ // Caso 3
					L[Ri] = L[Li];
					expansion = true; // requiere expansi�n
			}
			else if(L[Li] > (C+L[C])-Ri){ // Case 4
				L[Ri] = (C+L[C])-Ri;
				expansion = true; // requiere expansi�n
			}
    }
    else{
      L[Ri] = 0;
      expansion = true;  // requiere expansi�n
    }
    if (expansion) // hacer la expansi�n hasta donde se pueda
      while ((Ri + L[Ri]) < N && (Ri - L[Ri]) > 0
             && T[Ri+L[Ri]+1] == T[Ri-L[Ri]-1])
        L[Ri]++;
    if (Ri + L[Ri] > (C + L[C]))
      // si el nuevo pal�ndromo se expande m�s all� de C
			C = Ri;
    if(L[Ri] > maxLong){
      // Guardar longitud y centro del pal�ndromo m�s grande,
      // hasta ahora
			maxLong = L[Ri];
			maxCentro = Ri;
		}
  }
  // obtener inicio y longitud del m�ximo pal�ndromo encontrado
  // recordando que la longitud de T es el doble de la de S
  res.first = (maxCentro - maxLong)/2; // inicio en S
  res.second = maxLong; // longitud en S
  return res;
}


int main(){
    int Actividades, Secuencia, N;
    string virus, codigo;

    Secuencia = 0;
    Actividades = 0;


    ifstream archivo1("transmission1.txt");
    string Transmission1;
    ifstream archivo12("transmission1.txt");
    string Transmission12;
    ifstream archivo13("transmission1.txt");
    string Transmission13;
    
    string transmision1String( (istreambuf_iterator<char>(archivo1) ),
        (istreambuf_iterator<char>()    ) );
                  


    ifstream archivo2("transmission2.txt");
    string Transmission2;
    ifstream archivo22("transmission2.txt");
    string Transmission22;
    ifstream archivo23("transmission2.txt");
    string Transmission23;
    
    string transmision2String( (istreambuf_iterator<char>(archivo2) ),
        (istreambuf_iterator<char>()    ) );

    ifstream archivo3("mcode1.txt");
    string Mcode1;
    archivo3 >> Mcode1;

    ifstream archivo4("mcode2.txt");
    string Mcode2;
    archivo4 >> Mcode2;

    ifstream archivo5("mcode3.txt");
    string Mcode3;
    archivo5 >> Mcode3;

//******************** Actividad 1 ******************** 
//******************* Transmission1 ******************* 

    Contador = 0;
    tota = 0;
    while(archivo1 >> Transmission1) {  
        vector<int> preKMP = PreProcesamiento(Mcode1);
        int conta=0;
        KMP(Transmission1,Mcode1,preKMP,conta);
         
    }

    if (Contador != 0){
        cout << "true" << " " << "\n";
    }
    else{
        cout << "false" << "\n";
    } 

    Contador = 0;
    tota = 0;
    archivo12.seekg(0);
    while(archivo12 >> Transmission1) {
        vector<int> preKMP = PreProcesamiento(Mcode2);
        int conta=0;
        KMP(Transmission1,Mcode2,preKMP,conta);
    }

    if (Contador != 0){
        cout << "true" << " " << "\n";
    }
    else{
        cout << "false" << "\n";
    } 

    Contador = 0;
    tota = 0;
    archivo13.seekg(0);
    while(archivo13 >> Transmission1) {        
        vector<int> preKMP = PreProcesamiento(Mcode3);
        int conta=0;
        KMP(Transmission1,Mcode3,preKMP,conta); 
    }

    if (Contador != 0){
        cout << "true" << " " << "\n";
    }
    else{
        cout << "false" << "\n";
    } 

//******************* Transmission2 *******************
    Contador = 0;
    tota = 0;
    while(archivo2 >> Transmission1) {      
        vector<int> preKMP = PreProcesamiento(Mcode1);
        int conta=0;
        KMP(Transmission1,Mcode1,preKMP,conta);
    }

    if (Contador != 0){
        cout << "true" << " " << "\n";
    }
    else{
        cout << "false" << "\n";
    }

    Contador = 0;
    tota = 0;
    archivo22.seekg(0);
    while(archivo22 >> Transmission1) {        
        vector<int> preKMP = PreProcesamiento(Mcode2);
        int conta=0;
        KMP(Transmission1,Mcode2,preKMP,conta); 
    }

    if (Contador != 0){
        cout << "true" << " " << "\n";
    }
    else{
        cout << "false" << "\n";
    }

    Contador = 0;
    tota = 0;
    archivo23.seekg(0);
    while(archivo23 >> Transmission1) {
        vector<int> preKMP = PreProcesamiento(Mcode3);
        int conta=0;
        KMP(Transmission1,Mcode3,preKMP,conta); 
    }

    if (Contador != 0){
        cout << "true" << " " << "\n";
    }
    else{
        cout << "false" << "\n";
    } 
    


//******************** Actividad 2 ******************** 
	pair<int,int> res = manacher(transmision1String);
  	cout << res.first << "  " << res.first+res.second << "\n";
  	
  	pair<int,int> res2 = manacher(transmision2String);
  	cout << res2.first << "  " << res2.first+res2.second;

//******************** Actividad 3 ******************** 
std::ifstream t("transmission.txt");
std::stringstream buffer;
buffer << t.rdbuf();
cout << buffer
}


